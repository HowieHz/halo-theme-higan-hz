<!--/*-->
<head></head>
<body></body>
<!--*/-->
<th:block th:fragment="menu(showIcon)">
  <ul>
    <li class="icon" th:if="${showIcon}">
      <a href="#" onclick="event.preventDefault()" aria-expanded="false" role="button">
        <span class="iconify iconify-huge material-symbols--menu"></span>
      </a>
    </li>

    <th:block th:insert="~{fragments/common :: base-menu}"></th:block>
    <th:block th:each="item : ${theme.config?.styles?.extra_menu_items}">
      <!--/* random post button */-->
      <th:block th:if="${item?.type == 'random'}">
        <th:block th:with="allPostList=${postFinder.listAll()}">
          <li th:if="${not #lists.isEmpty(allPostList)}">
            <a
              href="/"
              th:with="randomIndex=${T(java.lang.Math).floor(T(java.lang.Math).random()*#lists.size(allPostList))},
                        postPermalink=${allPostList[randomIndex].status.permalink}"
              th:href="${postPermalink}"
              th:aria-label="#{fragment.menu.random-button.aria-label}"
              th:text="#{fragment.menu.random}"
            ></a>
          </li>
        </th:block>
      </th:block>
      <!--/* login status button */-->
      <li th:if="${item?.type == 'user'}">
        <a
          sec:authorize="isAnonymous()"
          href="/login"
          onclick="this.href = '/login?redirect_uri=' + encodeURIComponent(window.location.href)"
          th:text="#{fragment.menu.login}"
        >
        </a>
        <a
          sec:authorize="isAuthenticated()"
          th:with="loggedInUser = ${contributorFinder.getContributor(#authentication.name)}"
          th:text="${loggedInUser.displayName}"
          href="/uc"
        >
        </a>
      </li>
      <!--/* search widget button */-->
      <li th:if="${item?.type == 'search'} and ${pluginFinder.available('PluginSearchWidget')}">
        <a
          href="javascript:SearchWidget.open();"
          th:aria-label="#{fragment.menu.search-button.aria-label}"
          th:text="#{fragment.menu.search}"
        ></a>
      </li>
    </th:block>
  </ul>
</th:block>

<th:block th:fragment="base-menu">
  <th:block th:with="menuItems = ${menuFinder.getPrimary().menuItems}">
    <th:block th:unless="${theme.config?.global?.is_i18n_menu_show}">
      <!--/* 普通 menu */-->
      <li th:each="menuItem : ${menuItems}" class="matched-menu">
        <a
          th:href="@{${menuItem?.status?.href}}"
          th:target="${menuItem?.spec?.target?.value}"
          th:aria-label="#{fragment.menu.menuItem.aria-label(${menuItem.status?.displayName})}"
          th:text="${menuItem?.status?.displayName}"
          >目录项填充位置</a
        >
      </li>
    </th:block>

    <th:block
      th:if="${theme.config?.global?.is_i18n_menu_show} and not ${theme.config?.global?.is_i18n_prefix_match_mode}"
    >
      <!--/* i18n menu 全等匹配模式 */-->
      <th:block th:each="menuItem : ${menuItems}">
        <th:block th:if="${#strings.equals(menuItem.spec.displayName, page_language)}">
          <li th:each="menuItemChildren : ${menuItem?.children}" class="matched-menu">
            <a
              th:href="@{${menuItemChildren?.status?.href}}"
              th:target="${menuItemChildren?.spec?.target?.value}"
              th:aria-label="#{fragment.menu.menuItem.aria-label(${menuItemChildren.status?.displayName})}"
              th:text="${menuItemChildren?.status?.displayName}"
              >目录项填充位置</a
            >
          </li>
        </th:block>
      </th:block>
    </th:block>

    <th:block th:if="${theme.config?.global?.is_i18n_menu_show} and ${theme.config?.global?.is_i18n_prefix_match_mode}">
      <!--/* i18n menu 前缀匹配模式 */-->
      <th:block th:each="menuItem : ${menuItems}">
        <th:block th:if="${#strings.startsWith(page_language, menuItem.spec.displayName)}">
          <li th:each="menuItemChildren : ${menuItem?.children}" class="matched-menu">
            <a
              th:href="@{${menuItemChildren?.status?.href}}"
              th:target="${menuItemChildren?.spec?.target?.value}"
              th:aria-label="#{fragment.menu.menuItem.aria-label(${menuItemChildren.status?.displayName})}"
              th:text="${menuItemChildren?.status?.displayName}"
              >目录项填充位置</a
            >
          </li>
        </th:block>
      </th:block>
    </th:block>

    <th:block th:if="${theme.config?.global?.is_i18n_menu_show}">
      <!--/* i18n menu 全等匹配模式 匹配默认菜单 */-->
      <th:block th:each="menuItem : ${menuItems}">
        <th:block th:if="${#strings.equals(menuItem.spec.displayName, theme.config?.global?.default_page_language)}">
          <li th:each="menuItemChildren : ${menuItem.children}" style="display: none" class="default-menu">
            <a
              th:href="@{${menuItemChildren.status?.href}}"
              th:target="${menuItemChildren.spec.target?.value}"
              th:aria-label="#{fragment.menu.menuItem.aria-label(${menuItemChildren.status?.displayName})}"
              th:text="${menuItemChildren.status?.displayName}"
              >目录项填充位置</a
            >
          </li>
        </th:block>
      </th:block>
    </th:block>
  </th:block>
</th:block>

<th:block
  th:fragment="share(originPermalink,title)"
  th:with="siteUrl = ${#strings.substring(site.url, #strings.length(site.url) - 1)== '/'}? ${#strings.substring(site.url,0,#strings.length(site.url) - 1)}:${site.url}"
>
  <th:block th:with="permalink=${siteUrl}+${originPermalink}, title=${title}">
    <ul>
      <script vite-ignore th:inline="javascript">
        function nativeShare(link) {
          const postTitle = /*[[${title}]]*/ "";
          const shareData = { title: postTitle, url: link };
          if (navigator.canShare?.(shareData)) {
            navigator.share(shareData);
          } else {
            console.error("Sharing not supported");
          }
        }
      </script>
      <li th:each="item : ${theme?.config?.share?.button_config}">
        <a
          th:if="${item?.name!='Native'}"
          class="icon"
          th:aria-label="#{common.shareModal.share.aria-label(${item?.aria_label})}"
          th:href="${#strings.replace(#strings.replace(item?.url, '@URL', permalink), '@TITLE', title)}"
        >
          <span
            class="iconify"
            th:style="|--svg:url('${item?.icon.value}')|"
            th:if="${item?.icon != null} and ${item?.icon != ''}"
          ></span
          ><span
            class="iconify icomoon-free--mail4"
            th:if="${item?.name=='E-mail' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify pepicons-pencil--qr-code-circle-filled"
            th:if="${item?.name=='QRCode' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify ic--baseline-facebook"
            th:if="${item?.name=='Facebook' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify mdi--twitter-circle"
            th:if="${item?.name=='X' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify entypo-social--linkedin-with-circle"
            th:if="${item?.name=='LinkedIn' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify mdi--pinterest"
            th:if="${item?.name=='Pinterest' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify uil--telegram"
            th:if="${item?.name=='Telegram' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify ant-design--qq-circle-filled"
            th:if="${item?.name=='QQ' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify ant-design--weibo-circle-filled"
            th:if="${item?.name=='Weibo' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify ant-design--wechat-filled"
            th:if="${item?.name=='WeChat' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify cib--qzone"
            th:if="${item?.name=='Qzone' and (item?.icon == null or item?.icon == '')}"
          ></span
          ><span
            class="iconify tabler--brand-douban"
            th:if="${item?.name=='Douban' and (item?.icon == null or item?.icon == '')}"
          ></span
        ></a>
        <a
          th:if="${item?.name=='Native'}"
          class="icon"
          th:aria-label="#{common.shareModal.share.aria-label(${item?.aria_label})}"
          th:href="|javascript:nativeShare('${#strings.replace(item?.url, '@URL', permalink)}');|"
        >
          <span
            class="iconify"
            th:style="|--svg:url('${item?.icon.value}')|"
            th:if="${item?.icon != null} and ${item?.icon != ''}"
          ></span
          ><span
            class="iconify mdi--share-circle"
            th:if="${item?.name=='Native' and (item?.icon == null or item?.icon == '')}"
          ></span
        ></a>
      </li>
    </ul>
  </th:block>
</th:block>

<button
  th:fragment="theme-toggle-button"
  th:if="${theme.config?.styles?.is_show_color_scheme_toggle_button}"
  id="theme-toggle-button"
  accesskey="t"
  title="(Alt + T)"
  type="button"
  class="border-0 bg-transparent align-middle"
>
  <span
    id="theme-toggle-button-icon"
    style="display: none"
    class="icon iconify iconify-large -translate-x-px -translate-y-px"
  ></span>
  <style>
    #theme-toggle-button {
      & .icon:hover {
        color: var(--color-accent);
      }
    }
  </style>
</button>

<th:block
  th:fragment="auto-redirect"
  th:with="siteUrl = ${#strings.substring(site.url, #strings.length(site.url) - 1)== '/'}? ${#strings.substring(site.url,0,#strings.length(site.url) - 1)}:${site.url}"
>
  <p id="countdown" style="opacity: 0%; transition: opacity 1s"></p>
  <script vite-ignore th:inline="javascript">
    const countdownElement = document.getElementById("countdown");
    const siteUrl = /*[[${siteUrl}]]*/ "";
    var targetUrl = /*[[${theme.config?.error_page_styles?.target_url}]]*/ "/";
    if (targetUrl.startsWith("/")) {
      targetUrl = siteUrl + targetUrl;
    }
    let currentTimeLeft = /*[(${theme.config?.error_page_styles?.redirect_wait_time})]*/ 5;
    const originText = /*[[#{page.error.auto-refresh}]]*/ "";
    document.addEventListener("DOMContentLoaded", () => {
      countdownElement.innerHTML = `${originText
        .replace("{0}", currentTimeLeft)
        .replace("{1}", `<a href="${targetUrl}">${targetUrl}</a>`)}`;
      countdownElement.style.opacity = 1; // <!--/* 此处动画耗时一秒 */-->
      currentTimeLeft -= 1;
      const countdownInterval = setInterval(() => {
        if (currentTimeLeft <= 0) {
          clearInterval(countdownInterval);
          window.location.href = targetUrl;
        }
        countdownElement.innerHTML = `${originText
          .replace("{0}", currentTimeLeft)
          .replace("{1}", `<a href="${targetUrl}">${targetUrl}</a>`)}`;
        currentTimeLeft -= 1;
      }, 1000);
    });
  </script>
</th:block>
